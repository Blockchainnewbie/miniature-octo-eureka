<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navaro - Navigate, Rescue, Repeat</title>
    <!-- Bootstrap CSS für grundlegendes Layout und Komponenten -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome für Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Benutzerdefinierte Stylesheets für das Dashboard -->
    <link rel="stylesheet" href="../../../main.css">
    <!-- Dashboard-spezifisches JavaScript-Modul -->
    <script type="module" src="../../../controllers/dashboardController.js"></script>
</head>
<body class="bg-dark"> <!-- Dunkler Hintergrund für den gesamten Body -->
    <!-- Navbar / Header mit dunklem Tactical-Theme -->
    <nav class="navbar navbar-expand-lg navbar-dark"> <!-- Bootstrap Navbar-Klassen -->
        <div class="container-fluid">
            <!-- Markenname/Logo mit Icon und Badge -->
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-2"></i>Navaro <!-- Schild-Icon -->
                <small class="badge bg-warning ms-2">Tactical</small> <!-- "Tactical" Badge -->
            </a>
            <!-- Navbar-Toggler für mobile Ansichten -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#navbarNav" aria-controls="navbarNav" 
                    aria-expanded="false" aria-label="Navigation umschalten">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Navigationslinks -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-info-circle me-1"></i>Über uns
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-tools me-1"></i>Services
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-envelope me-1"></i>Kontakt
                        </a>
                    </li>
                </ul>
                <!-- Rechts ausgerichtete Navigations-Elemente (z.B. Logout) -->
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <!-- Logout-Link, Funktionalität wird über JavaScript (dashboard.js -> handleLogout) gesteuert -->
                        <a class="nav-link" href="#" title="Abmelden" onclick="dashboardService.handleLogout(); return false;">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hauptcontainer für den Seiteninhalt (Bootstrap Grid) -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar für Navigation und Statusanzeigen -->
            <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3"> <!-- Sticky-Position für die Sidebar -->
                    <ul class="nav flex-column">
                        <!-- Sidebar-Navigationslinks -->
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-map me-2"></i>Karten
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-route me-2"></i>Routen planen
                            </a>
                        </li>
                        <li class="nav-item" data-role="admin"> <!-- Nur für Admins sichtbar -->
                            <a class="nav-link" href="#">
                                <i class="fas fa-cog me-2"></i>Einstellungen
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-video me-2"></i>Live-Stream
                            </a>
                        </li>
                        <li class="nav-item" data-role="operator"> <!-- Für Admins und Operatoren sichtbar -->
                            <a class="nav-link" href="#">
                                <i class="fas fa-chart-line me-2"></i>Statistiken
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Status-Panel in der Sidebar -->
                    <div class="mt-4 p-3 bg-white rounded shadow-sm">
                        <h6 class="text-muted mb-2">Fahrzeug-Status</h6>
                        <div class="small">
                            <!-- Verbindungsstatus -->
                            <div class="d-flex justify-content-between mb-1">
                                <span>Verbindung:</span>
                                <!-- ID für dynamische Aktualisierung durch JavaScript -->
                                <span class="badge bg-success" id="connection-status-sidebar">Online</span> 
                            </div>
                            <!-- Batteriestatus -->
                            <div class="d-flex justify-content-between mb-1">
                                <span>Batterie:</span>
                                <span class="text-success" id="battery-level-sidebar">87%</span>
                            </div>
                            <!-- Signalstärke -->
                            <div class="d-flex justify-content-between">
                                <span>Signal:</span>
                                <span class="text-success" id="signal-strength-sidebar">Stark</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Hauptinhaltsbereich des Dashboards -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Kopfzeile des Hauptinhalts -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Navaro - Navigate, Rescue, Repeat</h1>
                    <!-- Toolbar mit Aktionsbuttons -->
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="dashboardService.startDataRefresh()">
                                <i class="fas fa-sync me-1"></i>Daten aktualisieren
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Haupt-Content-Sektion -->
                <section id="content" class="my-3">
                    <!-- Willkommens-Karte -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Willkommen bei Navaro</h5>
                            <p class="card-text">Ferngesteuerte Fahrzeugnavigation mit Live-Video-Stream und präziser Joystick-Steuerung für Rettungs- und Erkundungsmissionen.</p>
                            <!-- Button zum Starten des Live-Streams -->
                            <button class="btn btn-primary" id="start-stream-btn" onclick="dashboardService.initializeCameraStream()">
                                <i class="fas fa-play me-1"></i>Live-Stream starten/anzeigen
                            </button>
                        </div>
                    </div>

                    <!-- Status-Übersicht Karten (Kacheln) -->
                    <div class="row mb-4">
                        <!-- Verbindungskarte -->
                        <div class="col-sm-6 col-xl-3 mb-3">
                            <div class="card text-white bg-primary">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3"><i class="fas fa-wifi fa-2x"></i></div>
                                        <div>
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Verbindung</div>
                                            <!-- ID für dynamische Aktualisierung -->
                                            <div class="h5 mb-0 font-weight-bold"><span id="connection-display">Online</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Batteriekarte -->
                        <div class="col-sm-6 col-xl-3 mb-3">
                            <div class="card text-white bg-success">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3"><i class="fas fa-battery-three-quarters fa-2x"></i></div>
                                        <div>
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Batterie</div>
                                            <div class="h5 mb-0 font-weight-bold"><span id="battery-display">N/A</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Temperaturkarte -->
                        <div class="col-sm-6 col-xl-3 mb-3">
                            <div class="card text-white bg-warning">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3"><i class="fas fa-thermometer-half fa-2x"></i></div>
                                        <div>
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Temperatur</div>
                                            <div class="h5 mb-0 font-weight-bold"><span id="temperature-display">N/A</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Geschwindigkeitskarte -->
                        <div class="col-sm-6 col-xl-3 mb-3">
                            <div class="card text-white bg-info">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3"><i class="fas fa-tachometer-alt fa-2x"></i></div>
                                        <div>
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Geschwindigkeit</div>
                                            <div class="h5 mb-0 font-weight-bold"><span id="speed-display">0 km/h</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Responsives Video-Interface und Joystick-Steuerung -->
                    <div class="container-fluid my-4">
                        <div class="row g-4"> <!-- g-4 für Abstände zwischen Spalten -->
                            <!-- Video-Bereich (linke Seite) -->
                            <div class="col-lg-8 col-md-7">
                                <div class="video-container">
                                    <!-- Bootstrap Ratio Helper für responsives Video (16:9) -->
                                    <div class="ratio ratio-16x9 shadow rounded overflow-hidden">
                                        <!-- Platzhalter für den Video-Stream, wird durch JS ersetzt -->
                                        <div class="bg-dark d-flex align-items-center justify-content-center text-white" id="camera-stream">
                                            <div class="text-center">
                                                <i class="fas fa-video fa-3x mb-3"></i>
                                                <p>Kamera-Stream nicht aktiv</p>
                                                <!-- Button zum Verbinden der Kamera, Funktionalität über JS -->
                                                <button class="btn btn-outline-light" id="connect-camera-btn" onclick="apiService.camera.connect().then(r => console.log(r)).catch(e => console.error(e))">
                                                    <i class="fas fa-plug me-1"></i>Kamera verbinden
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Steuerungsbereich mit Joystick (rechte Seite) -->
                            <div class="col-lg-4 col-md-5">
                                <div class="card h-100 shadow-sm"> <!-- h-100 für volle Höhe der Spalte -->
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-gamepad me-2"></i>Fahrzeugsteuerung
                                        </h5>
                                    </div>
                                    <div class="card-body d-flex flex-column">
                                        <p class="card-text mb-4">Verwenden Sie den Joystick zur präzisen Steuerung des Fahrzeugs.</p>
                                        
                                        <!-- Joystick-Container -->
                                        <div class="d-flex justify-content-center mb-4">
                                            <!-- Äußerer Container des Joysticks -->
                                            <div class="joystick-container position-relative" style="width: 180px; height: 180px; background: linear-gradient(145deg, #f0f0f0, #e0e0e0); border-radius: 50%; box-shadow: inset 5px 5px 10px #d0d0d0, inset -5px -5px 10px #ffffff; touch-action: none;">
                                                <!-- Beweglicher Teil des Joysticks, ID für JS-Interaktion -->
                                                <div id="joystick" class="position-absolute bg-primary shadow" style="width: 50px; height: 50px; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); cursor: grab; transition: box-shadow 0.1s;"></div>
                                                <!-- Kreuzmarkierungen für bessere Orientierung -->
                                                <div class="position-absolute" style="top: 10px; left: 50%; transform: translateX(-50%); color: #999; font-size: 12px;">↑</div>
                                                <div class="position-absolute" style="bottom: 10px; left: 50%; transform: translateX(-50%); color: #999; font-size: 12px;">↓</div>
                                                <div class="position-absolute" style="left: 10px; top: 50%; transform: translateY(-50%); color: #999; font-size: 12px;">←</div>
                                                <div class="position-absolute" style="right: 10px; top: 50%; transform: translateY(-50%); color: #999; font-size: 12px;">→</div>
                                            </div>
                                        </div>
                                        
                                        <!-- Status-Anzeige für Joystick-Werte -->
                                        <div class="status-display mb-4">
                                            <div class="row text-center g-2">
                                                <div class="col-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Position</small>
                                                        <!-- ID für dynamische Aktualisierung der Joystick-Position -->
                                                        <span id="joystickPosition" class="fw-bold">X:0, Y:0</span>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Geschw.</small>
                                                        <!-- ID für dynamische Aktualisierung der Geschwindigkeit -->
                                                        <span id="speed" class="fw-bold text-success">0%</span>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="bg-light rounded p-2">
                                                        <small class="text-muted d-block">Richtung</small> <!-- Geändert von Status zu Richtung -->
                                                        <!-- ID für dynamische Aktualisierung der Richtung -->
                                                        <span id="direction" class="fw-bold text-warning">Stopp</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Steuerungsanleitung (unten in der Karte) -->
                                        <div class="mt-auto"> <!-- Schiebt diesen Block nach unten -->
                                            <h6 class="text-muted mb-2">Steuerung:</h6>
                                            <div class="row g-1 text-center">
                                                <div class="col-6"><small class="badge bg-light text-dark w-100">↑ Vorwärts</small></div>
                                                <div class="col-6"><small class="badge bg-light text-dark w-100">↓ Rückwärts</small></div>
                                                <div class="col-6"><small class="badge bg-light text-dark w-100">← Links</small></div>
                                                <div class="col-6"><small class="badge bg-light text-dark w-100">→ Rechts</small></div>
                                            </div>
                                            <small class="text-muted mt-2 d-block text-center">Entfernung vom Zentrum = Geschwindigkeit</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Footer-Bereich -->
    <footer class="footer mt-auto py-3 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2025 Navaro. Alle Rechte vorbehalten.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>Navigate, Rescue, Repeat</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle (mit Popper für Tooltips, Popovers etc.) -->
    <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Joystick-Controller-Skript, falls es nicht bereits in dashboard.js importiert wird -->
    <!-- <script type="module" src="./src/services/joystick.js"></script> -->
</body>
</html>
